<!DOCTYPE html>
<html lang="mr">
<head>
┬а <meta charset="UTF-8">
┬а <title>рддрд╛рд▓реБрдХрд╛ рдпреЛрдЬрдирд╛ рддреБрд▓рдирд╛рддреНрдордХ рдбреЕрд╢рдмреЛрд░реНрдб тАУ рдЬрд│рдЧрд╛рд╡ рдЬрд┐рд▓реНрд╣рд╛</title>
┬а <meta name="viewport" content="width=device-width, initial-scale=1" />
┬а ┬а <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@500;700&display=swap" rel="stylesheet"/>
┬а <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
┬а <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
┬а <style>
┬а ┬а /* рд╕рд╛рдорд╛рдиреНрдп рдмреЙрдбреА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а body { font-family: 'Noto Sans Devanagari', sans-serif; background: #f7fafc; color: #23263a; }
┬а ┬а /* рдЧреНрд▓рд╛рд╕ рдЗрдлреЗрдХреНрдЯ рдХрд╛рд░реНрдбрд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .glass { background: #fff; border-radius: 14px; box-shadow: 0 2px 10px #bac2f2bb; margin-bottom: 1.2rem; padding:1.1rem; }
┬а ┬а /* рдбреЕрд╢рдмреЛрд░реНрдбрдордзреАрд▓ рддреАрди рд╕реНрддрдВрднрд╛рдВрд╕рд╛рдареА рдлреНрд▓реЗрдХреНрд╕рдмреЙрдХреНрд╕ рд▓реЗрдЖрдЙрдЯ */
┬а ┬а .dashboard-3col { display: flex; flex-wrap: wrap; gap: 1.1rem; }
┬а ┬а .dashboard-3col > div { background: #f4f6fa; border-radius: 10px; padding: 0.7rem; flex: 1 1 30%; }
┬а ┬а /* KPI рдХрд╛рд░реНрдбрд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ (рдЯреЙрдк, рдордзреНрдпрдо, рддрд│) */
┬а ┬а .kpi-card { border-radius: 10px; text-align: center; padding: .55em .6em .4em .6em; font-size:0.99em; font-weight: 700; margin:.15em 0; box-shadow:0 2px 6px #dbeafe20;}
┬а ┬а .kpi-card span.chip { font-size:1em; display:block; font-weight:600;}
┬а ┬а .kpi-card.top┬а { background:linear-gradient(90deg,#bbf7d0 70%,#6ee7b7);}
┬а ┬а .kpi-card.mid┬а { background:linear-gradient(90deg,#fde68a,#fef9c3);}
┬а ┬а .kpi-card.bot┬а { background:linear-gradient(90deg,#fecaca,#f87171);}
┬а ┬а .kpi-card.selected { border: 2px solid #6366f1; box-shadow:0 3px 20px #a5b4fc33;}
┬а ┬а /* рд╡рд┐рднрд╛рдЧ/рддрд╛рд▓реБрдХрд╛ рдЪрд┐рдкреНрд╕рд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .dept-chip {
┬а ┬а ┬а display:inline-block; padding:7px 14px; border-radius:25px; font-size:.99em; background:#e0e7ff; margin:2px 6px 4px 0; color:#2d3d80;
┬а ┬а ┬а font-weight:600; box-shadow:0 2px 8px #5661b422;transition:transform .18s,background .15s;
┬а ┬а ┬а cursor:pointer; border:2.2px solid transparent;
┬а ┬а }
┬а ┬а .dept-chip:hover, .dept-chip.selected {
┬а ┬а ┬а background:linear-gradient(91deg,#facc15 25%,#fbbf24 100%);
┬а ┬а ┬а color:#262626; border-color:#f59e0b; transform:scale(1.08); z-index:2;
┬а ┬а }
┬а ┬а /* рдЪрд╛рд░реНрдЯ рдХрдВрдЯреЗрдирд░рд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .chart-container { height: 180px; min-height: 110px; } /* рдЪрд╛рд░реНрдЯрдЪреА рдореВрд│ рдЙрдВрдЪреА */
┬а ┬а .dashboard-3col .chart-container { background:#fff; border-radius:10px; padding:.25rem;}
┬а ┬а /* рдлреЙрд░реНрдо рд▓реЗрдмрд▓ рдЖрдгрд┐ рдмрдЯрдгрд╛рдВрд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .form-label { font-weight: 600;}
┬а ┬а .btn-export { margin-left:0.5rem;}
┬а ┬а /* рдЯреЗрдмрд▓рд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .table thead th {
┬а ┬а ┬а background: #6366f1; color: #fff; border: 1px solid #6366f1; text-align: center;vertical-align: middle; font-size:1.01em;padding:.48em;}
┬а ┬а .table tbody td { border: 1px solid #e6e6ed; vertical-align: middle; padding: .37rem .2rem; text-align:center; font-size:.95em;}
┬а ┬а .table tbody tr.selected-block td { background: #c7d2fe!important; font-weight:700; color:#1816a0;}
┬а ┬а .table tbody tr.top5┬а td { background: #bbf7d0 !important;}
┬а ┬а .table tbody tr.mid5┬а td { background: #feeaa4 !important;}
┬а ┬а .table tbody tr.bot5┬а td { background: #ffdada !important;}
┬а ┬а /* рдкреНрд░рддрд┐рд╕рд╛рджрд╛рддреНрдордХ рдбрд┐рдЭрд╛рдЗрди (рдореЛрдмрд╛рдИрд▓рд╕рд╛рдареА) */
┬а ┬а @media (max-width: 950px) {.dashboard-3col{flex-direction:column;gap:.8rem;}
┬а ┬а ┬а .dashboard-3col>div{min-width:0;}
┬а ┬а }
┬а ┬а /* рдорд╛рд╣рд┐рддреА рдмреЕрдЬрд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .info-badge {background: #f1f5fa;color: #344e74;font-size:.97em; padding:7px 12px; border-radius:8px;margin-bottom:1rem; border-left:4px solid #6366f1;}
┬а ┬а /* рдиреЗрд╡реНрд╣рд┐рдЧреЗрд╢рди рдЯреЕрдмрд╕рд╛рдареА рд╕реНрдЯрд╛рдЗрд▓рд┐рдВрдЧ */
┬а ┬а .nav-pills .nav-link { font-weight:600; }
┬а ┬а .nav-pills .nav-link.active { background: #6366f1; }
┬а </style>
</head>
<body>
<div class="container-fluid pb-3">
┬а <h2 class="text-center mb-2">ЁЯУК рддрд╛рд▓реБрдХрд╛ рдпреЛрдЬрдирд╛ рддреБрд▓рдирд╛рддреНрдордХ рдбреЕрд╢рдмреЛрд░реНрдб<br>
┬а ┬а <small class="text-muted" style="font-size:1em;">(рдЬрд│рдЧрд╛рд╡ рдЬрд┐рд▓реНрд╣рд╛)</small>
┬а </h2>
┬а <div class="glass mb-3">
┬а ┬а <div class="row g-2 align-items-center">
┬а ┬а ┬а <div class="col-md-6 col-lg-5">
┬а ┬а ┬а ┬а <label class="form-label">рдпреЛрдЬрдирд╛ рдирд┐рд╡рдбрд╛ (Multiple):</label>
┬а ┬а ┬а ┬а <select id="schemeSelect" multiple class="form-select form-select-sm" size="7"></select>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div class="col-md-6 col-lg-5">
┬а ┬а ┬а ┬а <label class="form-label">рддрд╛рд▓реБрдХрд╛ рдирд┐рд╡рдбрд╛:</label>
┬а ┬а ┬а ┬а <div id="talukaChips" class="mb-2"></div>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div class="col-md-12 col-lg-2 text-end mt-2 mt-lg-0">
┬а ┬а ┬а ┬а <button id="resetBtn" class="btn btn-outline-danger btn-sm">Reset</button>
┬а ┬а ┬а ┬а <button id="submitBtn" class="btn btn-primary btn-sm ms-2">Submit</button>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а ┬а <div class="row mt-1">
┬а ┬а ┬а <div class="col-12">
┬а ┬а ┬а ┬а <div class="info-badge">
┬а ┬а ┬а ┬а ┬а <i class="fa fa-info-circle me-1"></i>┬а
┬а ┬а ┬а ┬а ┬а <b>рд╕реВрдЪрдирд╛:</b> "рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛" рдирд┐рд╡рдбрдгреНрдпрд╛рд╕рд╛рдареА рдкрд╣рд┐рд▓рд╛ рдкрд░реНрдпрд╛рдп рдирд┐рд╡рдбрд╛. рддрд╛рд▓реБрдХрд╛ рдирд┐рд╡рдбрд╛, <b>Submit</b> рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рд╛. рдкреНрд░рддреНрдпреЗрдХ рддрд╛рд▓реБрдХреНрдпрд╛рд╕рд╛рдареА KPI рд╡рд░ рдХреНрд▓рд┐рдХ рдХреЗрд▓реНрдпрд╛рд╕ рддреНрдпрд╛ рддрд╛рд▓реБрдХреНрдпрд╛рдЪрд╛ scheme-wise self-assessment рд░рд┐рдкреЛрд░реНрдЯ рджрд┐рд╕реЗрд▓.
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а </div>
┬а┬а
┬а <div class="glass">
┬а ┬а <div class="dashboard-3col">
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div id="kpiCol"></div>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div class="text-primary mb-2" style="font-weight:700;font-size:.98em;">Bar Chart</div>
┬а ┬а ┬а ┬а <div id="barArea" class="chart-container"><canvas id="barChart"></canvas></div>
┬а ┬а ┬а ┬а <button id="downloadBarBtn" class="btn btn-success btn-sm btn-export mt-1">тмЗя╕П Bar Chart</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div class="text-primary mb-2" style="font-weight:700;font-size:.98em;">Donut Chart</div>
┬а ┬а ┬а ┬а <div id="donutArea" class="chart-container"><canvas id="donutChart"></canvas></div>
┬а ┬а ┬а ┬а <button id="downloadDonutBtn" class="btn btn-warning btn-sm btn-export mt-1">тмЗя╕П Donut Chart</button>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а </div>
┬а <div class="glass mb-3">
┬а ┬а <h5 class="mb-2 text-primary" style="font-size:1.08em;">
┬а ┬а ┬а <i class="fa fa-table me-2"></i>рддрд╛рд▓реБрдХреНрдпрд╛рдВрдЪреА рдкреВрд░реНрдг рдорд╛рд╣рд┐рддреА рд╡ рд░рдБрдХрд┐рдВрдЧ
┬а ┬а ┬а <button id="downloadCsvBtn" class="btn btn-secondary btn-xs btn-export float-end">ЁЯУК CSV</button>
┬а ┬а </h5>
┬а ┬а <div class="table-responsive">
┬а ┬а ┬а <table class="table table-bordered mb-0" id="dataTable">
┬а ┬а ┬а ┬а <thead><tr id="tableHeader"></tr></thead>
┬а ┬а ┬а ┬а <tbody id="tableBody"></tbody>
┬а ┬а ┬а </table>
┬а ┬а </div>
┬а </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
// рдХреЙрдиреНрдлрд┐рдЧреЗрд╢рди рдСрдмреНрдЬреЗрдХреНрдЯ: API рдХреА, рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рдЖрдпрдбреА рдЖрдгрд┐ рдбреЗрдЯрд╛ рд░реЗрдВрдЬ
const CONFIG = {
┬а apiKey: "AIzaSyDhCjnUv7x5yj9cXKV52Qv8CrYwUhBIWuU",
┬а spreadsheetId: "1y_EVqNg-reS3xV-Kn6cmTou7u_6kuyqykNdgdzXEMkE",
┬а range: "Rank!B5:AJ20" // рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯрдордзреАрд▓ рдбреЗрдЯрд╛рдЪреА рд░реЗрдВрдЬ
};

// рдЧреНрд▓реЛрдмрд▓ рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓реНрд╕
let rawData=[], headers=[], blocks=[], schemes=[];
let barChart, donutChart;
const selectedBlocks = new Set(), selectedSchemes = new Set();

// Google Sheets рдордзреВрди рдбреЗрдЯрд╛ рдЖрдгрдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
async function fetchSheet() {
┬а const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.spreadsheetId}/values/${encodeURIComponent(CONFIG.range)}?majorDimension=ROWS&valueRenderOption=UNFORMATTED_VALUE&key=${CONFIG.apiKey}`;
┬а const res = await fetch(url);
┬а if (!res.ok) throw Error(res.statusText);
┬а return (await res.json()).values;
}

// рдЖрд▓реЗрд▓рд╛ рдбреЗрдЯрд╛ рдкрд╛рд░реНрд╕ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function parse(values) {
┬а headers = values[0]; // рдкрд╣рд┐рд▓реА рдУрд│ рд╣реЗрдбрд░реНрд╕ рдореНрд╣рдгреВрди
┬а const idxBlock=headers.findIndex(h=>/рддрд╛рд▓реБрдХрд╛/i.test(h)); // 'рддрд╛рд▓реБрдХрд╛' рдирд╛рд╡рд╛рдЪреНрдпрд╛ рд╕реНрддрдВрднрд╛рдЪрд╛ рдЗрдВрдбреЗрдХреНрд╕ рд╢реЛрдзрд╛
┬а // рдбреЗрдЯрд╛рдЪреНрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдУрд│реАрд▓рд╛ рдСрдмреНрдЬреЗрдХреНрдЯрдордзреНрдпреЗ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рд╛
┬а blocks = values.slice(1).map(r => {
┬а ┬а const obj={}; 
┬а ┬а headers.forEach((h,i)=>obj[h]=r[i]); 
┬а ┬а obj._block=r[idxBlock]; // рддрд╛рд▓реБрдХреНрдпрд╛рдЪреЗ рдирд╛рд╡ _block рдордзреНрдпреЗ рд╕рд╛рдард╡рд╛
┬а ┬а return obj;
┬а });
┬а // 'рддрд╛рд▓реБрдХрд╛' рд╡рдЧрд│рддрд╛ рд╕рд░реНрд╡ рд╣реЗрдбрд░реНрд╕ рдпреЛрдЬрдирд╛ (schemes) рдореНрд╣рдгреВрди рд╕реЗрдЯ рдХрд░рд╛
┬а schemes = headers.filter((_,i) => i!==idxBlock);
┬а rawData = blocks; // рдкрд╛рд░реНрд╕ рдХреЗрд▓реЗрд▓рд╛ рдбреЗрдЯрд╛ rawData рдордзреНрдпреЗ рд╕рд╛рдард╡рд╛
}

// рдирд┐рдпрдВрддреНрд░рдг рдШрдЯрдХ (рдбреНрд░реЙрдкрдбрд╛рдЙрди, рдЪрд┐рдкреНрд╕, рдмрдЯрдгреЗ) рд░реЗрдВрдбрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function renderControls() {
┬а const schemeSel=document.getElementById('schemeSelect');
┬а // рдпреЛрдЬрдирд╛ рдирд┐рд╡рдб рдбреНрд░реЙрдкрдбрд╛рдЙрдирдордзреНрдпреЗ рдкрд░реНрдпрд╛рдп рдЬреЛрдбрд╛
┬а schemeSel.innerHTML = `<option value="__all__" style="font-weight:bold;">рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛</option>`┬а
┬а ┬а ┬а ┬а + schemes.map(s=>`<option value="${s}">${s}</option>`).join('');
┬а // рдбреНрд░реЙрдкрдбрд╛рдЙрдирдордзреАрд▓ рдмрджрд▓рд╛рдВрд╡рд░ рд▓рдХреНрд╖ рдареЗрд╡рдгреНрдпрд╛рд╕рд╛рдареА рдЗрд╡реНрд╣реЗрдВрдЯ рд▓рд┐рд╕рдирд░
┬а schemeSel.addEventListener('change',()=>{
┬а ┬а const val = Array.from(schemeSel.selectedOptions).map(o=>o.value);
┬а ┬а const allSelected = val.includes('__all__');
┬а ┬а if(allSelected) {
┬а ┬а ┬а for (let option of schemeSel.options) if (option.value !== '__all__') option.selected=true;
┬а ┬а }
┬а ┬а // рдЬрд░ 'рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛' рдирд┐рд╡рдбрд▓реЗ рдирд╕реЗрд▓ рддрд░ рддреЗ рдЕрдирдЪреЗрдХ рдХрд░рд╛
┬а ┬а const allActual = Array.from(schemeSel.options).filter(o=>o.value!=="__all__" && o.selected);
┬а ┬а if(allActual.length===schemes.length)
┬а ┬а ┬а schemeSel.querySelector('option[value="__all__"]').selected=true;
┬а ┬а else
┬а ┬а ┬а schemeSel.querySelector('option[value="__all__"]').selected=false;
┬а });

┬а // рддрд╛рд▓реБрдХрд╛ рдЪрд┐рдкреНрд╕ рд░реЗрдВрдбрд░ рдХрд░рд╛
┬а const talukaDiv=document.getElementById('talukaChips');
┬а talukaDiv.innerHTML=blocks.map(b=>`
┬а ┬а <span class="dept-chip" tabindex="0" data-block="${b._block}">${b._block}</span>
┬а `).join('');
┬а // рддрд╛рд▓реБрдХрд╛ рдЪрд┐рдкреНрд╕рдЪреНрдпрд╛ рдХреНрд▓рд┐рдХ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд▓рд┐рд╕рдирд░
┬а talukaDiv.querySelectorAll('.dept-chip').forEach(span=>{
┬а ┬а span.onclick=()=>{
┬а ┬а ┬а const name=span.getAttribute('data-block');
┬а ┬а ┬а if(selectedBlocks.has(name)) { selectedBlocks.delete(name); span.classList.remove('selected');}
┬а ┬а ┬а else {selectedBlocks.add(name); span.classList.add('selected');}
┬а ┬а };
┬а });

┬а // рд░реАрд╕реЗрдЯ рдмрдЯрдгрд╛рдЪреНрдпрд╛ рдХреНрд▓рд┐рдХ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд▓рд┐рд╕рдирд░
┬а document.getElementById('resetBtn').onclick = () => {
┬а ┬а selectedBlocks.clear(); 
┬а ┬а selectedSchemes.clear();
┬а ┬а talukaDiv.querySelectorAll('.dept-chip').forEach(span=>span.classList.remove('selected'));
┬а ┬а schemeSel.selectedIndex=-1; // рдбреНрд░реЙрдкрдбрд╛рдЙрди рд░реАрд╕реЗрдЯ рдХрд░рд╛
┬а ┬а clearDashboard(); // рдбреЕрд╢рдмреЛрд░реНрдб рд╕рд╛рдл рдХрд░рд╛
┬а ┬а showAllDefault(); // рдбреАрдлреЙрд▓реНрдЯрдиреБрд╕рд╛рд░ рд╕рд░реНрд╡ рдбреЗрдЯрд╛ рджрд╛рдЦрд╡рд╛
┬а };
┬а // рд╕рдмрдорд┐рдЯ рдмрдЯрдгрд╛рдЪреНрдпрд╛ рдХреНрд▓рд┐рдХ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд▓рд┐рд╕рдирд░
┬а document.getElementById('submitBtn').onclick = updateAll;
┬а // рдЪрд╛рд░реНрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдмрдЯрдгрд╛рдВрдЪреНрдпрд╛ рдХреНрд▓рд┐рдХ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд▓рд┐рд╕рдирд░
┬а document.getElementById('downloadBarBtn').onclick=()=>barChart && downloadChart(barChart,"bar-chart.png");
┬а document.getElementById('downloadDonutBtn').onclick=()=>donutChart && downloadChart(donutChart,"donut-chart.png");
┬а // CSV рдбрд╛рдЙрдирд▓реЛрдб рдмрдЯрдгрд╛рдЪреНрдпрд╛ рдХреНрд▓рд┐рдХ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд▓рд┐рд╕рдирд░
┬а document.getElementById('downloadCsvBtn').onclick = downloadCSV;
}

// рдЪрд╛рд░реНрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╕рд╣рд╛рдпрдХ рдлрдВрдХреНрд╢рди
function downloadChart(chart,filename){
┬а const a=document.createElement('a');
┬а a.href=chart.toBase64Image(); 
┬а a.download=filename; 
┬а a.click();
}

// рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдпреЛрдЬрдирд╛ рдЖрдгрд┐ рддрд╛рд▓реБрдХреЗ рдЧреЛрд│рд╛ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function collectSelections() {
┬а // рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рддрд╛рд▓реБрдХрд╛ рдЪрд┐рдкреНрд╕ рдЧреЛрд│рд╛ рдХрд░рд╛
┬а selectedBlocks.clear();
┬а document.querySelectorAll('#talukaChips .dept-chip.selected').forEach(el=>selectedBlocks.add(el.getAttribute('data-block')));
┬а // рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдпреЛрдЬрдирд╛ рдбреНрд░реЙрдкрдбрд╛рдЙрдирдордзреВрди рдЧреЛрд│рд╛ рдХрд░рд╛
┬а selectedSchemes.clear();
┬а Array.from(document.getElementById('schemeSelect').selectedOptions).forEach(opt => {
┬а ┬а if(opt.value === "__all__") {
┬а ┬а ┬а schemes.forEach(s=>selectedSchemes.add(s));
┬а ┬а } else {
┬а ┬а ┬а selectedSchemes.add(opt.value);
┬а ┬а }
┬а });
}

// рдореБрдЦреНрдп рдбреЗрдЯрд╛ рдЧрдгрдирд╛ рдлрдВрдХреНрд╢рди
function compute() {
┬а collectSelections(); // рд╕рдзреНрдпрд╛рдЪреНрдпрд╛ рдирд┐рд╡рдбреА рдЧреЛрд│рд╛ рдХрд░рд╛
┬а const schemesArr = selectedSchemes.size ? Array.from(selectedSchemes) : schemes.slice(); // рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдпреЛрдЬрдирд╛, рдирд╕рд▓реНрдпрд╛рд╕ рд╕рд░реНрд╡
┬а const blocksArr = selectedBlocks.size ? Array.from(selectedBlocks).map(b=>rawData.find(r=>r._block===b)).filter(Boolean) : rawData.slice(); // рдирд┐рд╡рдбрд▓реЗрд▓реЗ рддрд╛рд▓реБрдХреЗ, рдирд╕рд▓реНрдпрд╛рд╕ рд╕рд░реНрд╡

┬а // рдкреНрд░рддреНрдпреЗрдХ рддрд╛рд▓реБрдХреНрдпрд╛рд╕рд╛рдареА '1' рдЪреНрдпрд╛ рдореВрд▓реНрдпрд╛рдВрдЪреА рд╕рдВрдЦреНрдпрд╛ рдореЛрдЬрд╛ рдЖрдгрд┐ рд░рдБрдХрд┐рдВрдЧрд╕рд╛рдареА рдбреЗрдЯрд╛ рддрдпрд╛рд░ рдХрд░рд╛
┬а const kpiData = blocksArr.map(block => {
┬а ┬а let oneCount = 0;
┬а ┬а schemes.forEach(scheme => { // рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛ рд╕реНрддрдВрднрд╛рдВрд╡рд░ рдлрд┐рд░рд╛
┬а ┬а ┬а if (parseFloat(block[scheme]) === 1) { // рдЬрд░ рдореВрд▓реНрдп рд╕рдВрдЦреНрдпрд╛рддреНрдордХ '1' рдЕрд╕реЗрд▓ рддрд░ рдореЛрдЬрд╛
┬а ┬а ┬а ┬а oneCount++;
┬а ┬а ┬а }
┬а ┬а });
┬а ┬а return { _block: block._block, val: oneCount }; // 'val' рдЖрддрд╛ '1' рдЪреА рд╕рдВрдЦреНрдпрд╛ рджрд░реНрд╢рд╡рддреЗ
┬а });
┬а kpiData.sort((a,b)=>b.val-a.val); // '1' рдЪреНрдпрд╛ рд╕рдВрдЦреНрдпреЗрдиреБрд╕рд╛рд░ рдЙрддрд░рддреНрдпрд╛ рдХреНрд░рдорд╛рдиреЗ рдХреНрд░рдорд╡рд╛рд░реА рд▓рд╛рд╡рд╛
┬а kpiData.forEach((d,i)=>d.rank=i+1); // рд░рдБрдХ рдирд┐рдпреБрдХреНрдд рдХрд░рд╛

┬а // KPI рдбрд┐рд╕реНрдкреНрд▓реЗрд╕рд╛рдареА, рдирд┐рд╡рдбрд▓реЗрд▓реА рдкрд╣рд┐рд▓реА рдпреЛрдЬрдирд╛ рдХрд┐рдВрд╡рд╛ рдЙрдкрд▓рдмреНрдз рдкрд╣рд┐рд▓реА рдпреЛрдЬрдирд╛ рд╡рд╛рдкрд░рд╛.
┬а // рдкрд░рдВрддреБ рдореБрдЦреНрдп рд░рдБрдХрд┐рдВрдЧ рд▓реЙрдЬрд┐рдХ рдЖрддрд╛ '1' рдЪреНрдпрд╛ рд╕рдВрдЦреНрдпреЗрд╡рд░ рдЕрд╡рд▓рдВрдмреВрди рдЖрд╣реЗ.
┬а const kpiScheme = schemesArr.length ? schemesArr[0] : (schemes[0]||"");

┬а return { blocksArr, kpiData, schemesArr, kpiScheme };
}

// KPI рдХрд╛рд░реНрдб рд░реЗрдВрдбрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function renderKPI(data) {
┬а if(!data || data.kpiData.length === 0) { document.getElementById('kpiCol').innerHTML = ""; return; }
┬а let out = "";
┬а if(data.kpiData[0]) out += `
┬а ┬а <div class="kpi-card top selected" onclick="selfAssessment('${data.kpiData[0]._block}')">
┬а ┬а ┬а <span class="chip">ЁЯПЖ Top</span>${data.kpiData[0]._block}<div>${data.kpiData[0].val}</div>
┬а ┬а </div>`;
┬а if(data.kpiData.length>2){
┬а ┬а const midIndex = Math.floor(data.kpiData.length/2);
┬а ┬а const mid = data.kpiData[midIndex];
┬а ┬а out += `<div class="kpi-card mid selected" onclick="selfAssessment('${mid._block}')">
┬а ┬а ┬а <span class="chip">тЪЦя╕П рдордзреНрдпрдо</span>${mid._block}<div>${mid.val}</div></div>`;
┬а }
┬а if(data.kpiData.at(-1)){
┬а ┬а out += `<div class="kpi-card bot selected" onclick="selfAssessment('${data.kpiData.at(-1)._block}')">
┬а ┬а ┬а <span class="chip">ЁЯЪи рддрд│</span>${data.kpiData.at(-1)._block}<div>${data.kpiData.at(-1).val}</div></div>`;
┬а }
┬а document.getElementById('kpiCol').innerHTML = out;
}

// рддрд╛рд▓реБрдХреНрдпрд╛рдЪреНрдпрд╛ рд╕реНрд╡рдпрдВ-рдореВрд▓реНрдпрд╛рдВрдХрдирд╛рд╕рд╛рдареА рдкреЙрдкрдЕрдк
window.selfAssessment = function(talukaName) {
┬а if(!talukaName) return;
┬а const assessments = schemes.map(scheme => {
┬а ┬а const ranks = rawData.map(r => ({
┬а ┬а ┬а taluka: r._block, val: parseFloat(r[scheme]) || 0
┬а ┬а })).sort((a,b) => b.val - a.val);
┬а ┬а const rankObj = ranks.find(x => x.taluka === talukaName);
┬а ┬а return { scheme, rank: rankObj ? ranks.indexOf(rankObj) + 1 : null, score: rankObj ? rankObj.val : 0 };
┬а });
┬а assessments.sort((a,b) => a.rank-b.rank);
┬а const n = rawData.length;
┬а const top5 = assessments.filter(a=>a.rank && a.rank<=5);
┬а const bottom5 = assessments.filter(a=>a.rank && a.rank>=(n-4));
┬а alert("рддрд╛рд▓реБрдХрд╛: "+talukaName+
┬а ┬а "\n\nЁЯПЖ рдЙрддреНрддрдо рдпреЛрдЬрдирд╛ (Top 5):\n"+top5.map(a=>`${a.scheme}: ${a.rank} (${a.score})`).join('\n')+
┬а ┬а "\n\nЁЯЪи рд▓рдХреНрд╖ рджреНрдпрд╛рд╡реНрдпрд╛рдд рдЕрд╢рд╛ (Bottom 5):\n"+bottom5.map(a=>`${a.scheme}: ${a.rank} (${a.score})`).join('\n')
┬а );
};

// рдмрд╛рд░ рдЪрд╛рд░реНрдЯ рд░реЗрдВрдбрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function renderBar(data) {
┬а const ctx=document.getElementById('barChart').getContext('2d');
┬а barChart?.destroy(); // рдЬреБрдирд╛ рдЪрд╛рд░реНрдЯ рдирд╖реНрдЯ рдХрд░рд╛
┬а barChart=new Chart(ctx, {
┬а ┬а type:'bar',
┬а ┬а data: {
┬а ┬а ┬а labels: data.kpiData.map(d=>d._block), // рддрд╛рд▓реБрдХреНрдпрд╛рдВрдЪреА рдирд╛рд╡реЗ рд▓реЗрдмрд▓реНрд╕ рдореНрд╣рдгреВрди
┬а ┬а ┬а datasets: [{
┬а ┬а ┬а ┬а label: '1 рдЪреА рд╕рдВрдЦреНрдпрд╛', // рд▓реЗрдмрд▓ '1' рдЪреНрдпрд╛ рд╕рдВрдЦреНрдпреЗрд╕рд╛рдареА рдЕрджреНрдпрддрдирд┐рдд рдХреЗрд▓реЗ
┬а ┬а ┬а ┬а data: data.kpiData.map(d=>d.val), // '1' рдЪреА рд╕рдВрдЦреНрдпрд╛ рдбреЗрдЯрд╛ рдореНрд╣рдгреВрди
┬а ┬а ┬а ┬а backgroundColor:'#6366f1', borderRadius:4
┬а ┬а ┬а }]
┬а ┬а },
┬а ┬а options:{
┬а ┬а ┬а indexAxis:'y', // y-рдЕрдХреНрд╖рд╛рд╡рд░ рдмрд╛рд░ рджрд░реНрд╢рд╡рд╛
┬а ┬а ┬а plugins:{ 
┬а ┬а ┬а ┬а legend:{display:false}, // рд▓реЗрдЬреЗрдВрдб рджрд╛рдЦрд╡реВ рдирдХрд╛
┬а ┬а ┬а ┬а datalabels:{anchor:'end',align:'right',formatter:v=>v} // рдбреЗрдЯрд╛ рд▓реЗрдмрд▓рд╕рд╛рдареА рд╕реЗрдЯрд┐рдВрдЧреНрдЬ
┬а ┬а ┬а },
┬а ┬а ┬а responsive:true, // рдкреНрд░рддрд┐рд╕рд╛рдж рджреЗрдгрд╛рд░рд╛ рдЪрд╛рд░реНрдЯ
┬а ┬а ┬а maintainAspectRatio: false, // рдХрдВрдЯреЗрдирд░рдЪреА рдкреВрд░реНрдг рд░реБрдВрджреА рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА
┬а ┬а ┬а scales: {
┬а ┬а ┬а ┬а x: {
┬а ┬а ┬а ┬а ┬а beginAtZero: true,
┬а ┬а ┬а ┬а ┬а ticks: {
┬а ┬а ┬а ┬а ┬а ┬а precision: 0 // рд╕рдВрдЦреНрдпрд╛рдВрд╕рд╛рдареА рдкреВрд░реНрдгрд╛рдВрдХ рдореВрд▓реНрдпреЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рд╛
┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а }
┬а ┬а },
┬а ┬а plugins:[ChartDataLabels] // рдбреЗрдЯрд╛ рд▓реЗрдмрд▓реНрд╕ рдкреНрд▓рдЧрдЗрди рд╡рд╛рдкрд░рд╛
┬а });
}

// рдбреЛрдирдЯ рдЪрд╛рд░реНрдЯ рд░реЗрдВрдбрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function renderDonut(data) {
┬а const ctx=document.getElementById('donutChart').getContext('2d');
┬а donutChart?.destroy(); // рдЬреБрдирд╛ рдЪрд╛рд░реНрдЯ рдирд╖реНрдЯ рдХрд░рд╛
┬а donutChart=new Chart(ctx, {
┬а ┬а type:'doughnut',
┬а ┬а data:{
┬а ┬а ┬а labels: data.kpiData.map(d=>d._block), // рддрд╛рд▓реБрдХреНрдпрд╛рдВрдЪреА рдирд╛рд╡реЗ рд▓реЗрдмрд▓реНрд╕ рдореНрд╣рдгреВрди
┬а ┬а ┬а datasets:[{
┬а ┬а ┬а ┬а data: data.kpiData.map(d=>d.val), // '1' рдЪреА рд╕рдВрдЦреНрдпрд╛ рдбреЗрдЯрд╛ рдореНрд╣рдгреВрди
┬а ┬а ┬а ┬а backgroundColor:['#4f46e5','#10b981','#f59e0b','#ef4444','#3b82f6','#818cf8','#f472b6','#2dd4bf','#facc15','#eab308','#c026d3']
┬а ┬а ┬а }]
┬а ┬а },
┬а ┬а options:{ 
┬а ┬а ┬а plugins:{ 
┬а ┬а ┬а ┬а legend:{position:'bottom'}, // рд▓реЗрдЬреЗрдВрдб рдЦрд╛рд▓реА рджрд╛рдЦрд╡рд╛
┬а ┬а ┬а ┬а datalabels:{anchor:'end',align:'end',formatter:v=>v} // рдбреЗрдЯрд╛ рд▓реЗрдмрд▓рд╕рд╛рдареА рд╕реЗрдЯрд┐рдВрдЧреНрдЬ
┬а ┬а ┬а }, 
┬а ┬а ┬а responsive:true, // рдкреНрд░рддрд┐рд╕рд╛рдж рджреЗрдгрд╛рд░рд╛ рдЪрд╛рд░реНрдЯ
┬а ┬а ┬а maintainAspectRatio: false // рдХрдВрдЯреЗрдирд░рдЪреА рдкреВрд░реНрдг рд░реБрдВрджреА рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА
┬а ┬а },
┬а ┬а plugins:[ChartDataLabels] // рдбреЗрдЯрд╛ рд▓реЗрдмрд▓реНрд╕ рдкреНрд▓рдЧрдЗрди рд╡рд╛рдкрд░рд╛
┬а });
}

// рдЯреЗрдмрд▓ рд░реЗрдВрдбрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function renderTable(data) {
┬а const th = `<th>рд░рдБрдХ</th>` + headers.map(h => `<th>${h}</th>`).join(''); // рдЯреЗрдмрд▓ рд╣реЗрдбрд░ рддрдпрд╛рд░ рдХрд░рд╛
┬а document.getElementById('tableHeader').innerHTML = th;
┬а const n = data.kpiData.length;
┬а 
┬а // рдордзреНрдпрднрд╛рдЧреА 5 рдкрдВрдХреНрддреА рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА (рд╡реНрд╣рд┐рдЬреНрдпреБрдЕрд▓ рдЧреНрд░реБрдкрд┐рдВрдЧрд╕рд╛рдареА)
┬а const middleStartIndex = Math.max(0, Math.floor(n / 2) - 2);
┬а const middleEndIndex = Math.min(n - 1, middleStartIndex + 4);

┬а const rows = data.kpiData.map((r,i) => {
┬а ┬а const classes = [
┬а ┬а ┬а i < 5 ? 'top5' : '', // рдЯреЙрдк 5 рдкрдВрдХреНрддреАрдВрд╕рд╛рдареА рдХреНрд▓рд╛рд╕
┬а ┬а ┬а i >= n - 5 ? 'bot5' : '', // рдмреЙрдЯрдо 5 рдкрдВрдХреНрддреАрдВрд╕рд╛рдареА рдХреНрд▓рд╛рд╕
┬а ┬а ┬а // рдордзреНрдпрднрд╛рдЧреА рдЕрд╕рд▓реЗрд▓реНрдпрд╛ рдкрдВрдХреНрддреАрдВрд╕рд╛рдареА рдХреНрд▓рд╛рд╕ (рдЯреЙрдк/рдмреЙрдЯрдо 5 рдордзреНрдпреЗ рдирд╕рд▓реЗрд▓реНрдпрд╛)
┬а ┬а ┬а (i >= middleStartIndex && i <= middleEndIndex && i >= 5 && i < n - 5) ? 'mid5' : '', 
┬а ┬а ┬а selectedBlocks.has(r._block) ? 'selected-block' : '' // рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдмреНрд▓реЙрдХрд╕рд╛рдареА рдХреНрд▓рд╛рд╕
┬а ┬а ].filter(Boolean).join(' ');
┬а ┬а 
┬а ┬а // рд╕рд░реНрд╡ рд╕реНрддрдВрдн рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдореВрд│ rawData рдПрдВрдЯреНрд░реА рд╢реЛрдзрд╛
┬а ┬а const originalDataRow = rawData.find(x => x._block === r._block);
┬а ┬а return `
┬а ┬а ┬а <tr class="${classes}">
┬а ┬а ┬а ┬а <td>${r.rank}</td>${headers.map(h => `<td>${originalDataRow[h] || ''}</td>`).join('')}
┬а ┬а ┬а </tr>`;
┬а }).join('');
┬а document.getElementById('tableBody').innerHTML = rows;
}

// рдбреАрдлреЙрд▓реНрдЯрдиреБрд╕рд╛рд░ рд╕рд░реНрд╡ рдбреЗрдЯрд╛ рджрд╛рдЦрд╡рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди (рдЬреЗрд╡реНрд╣рд╛ рдХреЛрдгрддреАрд╣реА рдирд┐рд╡рдб рдирд╕рддреЗ)
function showAllDefault() {
┬а selectedSchemes.clear(); schemes.forEach(s=>selectedSchemes.add(s)); // рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛ рдирд┐рд╡рдбрд╛
┬а selectedBlocks.clear(); blocks.forEach(b=>selectedBlocks.add(b._block)); // рд╕рд░реНрд╡ рддрд╛рд▓реБрдХреЗ рдирд┐рд╡рдбрд╛
┬а // 'рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛' рдкрд░реНрдпрд╛рдп рдирд┐рд╡рдбрд▓реЗрд▓рд╛ рджрд┐рд╕рдгреНрдпрд╛рд╕рд╛рдареА
┬а const allSchemesOption = document.querySelector('#schemeSelect option[value="__all__"]');
┬а if (allSchemesOption) {
┬а ┬а allSchemesOption.selected = true;
┬а ┬а // рдЗрддрд░ рд╕рд░реНрд╡ рдкрд░реНрдпрд╛рдп рджреЗрдЦреАрд▓ рдирд┐рд╡рдбрд▓реЗрд▓реЗ рджрд┐рд╕рдгреНрдпрд╛рд╕рд╛рдареА
┬а ┬а Array.from(document.getElementById('schemeSelect').options).forEach(opt => {
┬а ┬а ┬а if (opt.value !== '__all__') opt.selected = true;
┬а ┬а });
┬а }
┬а document.querySelectorAll('#talukaChips .dept-chip').forEach(span=>span.classList.remove('selected')); // рд╕реБрд░реБрд╡рд╛рддреАрд▓рд╛ рд╕рд░реНрд╡ рдЪрд┐рдкреНрд╕ рдЕрдирд╕реЗрд▓реЗрдХреНрдЯ рдХрд░рд╛
┬а updateAll(); // рдбреЕрд╢рдмреЛрд░реНрдб рдЕрджреНрдпрддрдирд┐рдд рдХрд░рд╛
}

// рдбреЕрд╢рдмреЛрд░реНрдб рд╕рд╛рдл рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function clearDashboard() {
┬а document.getElementById('kpiCol').innerHTML="";
┬а document.getElementById('tableBody').innerHTML="";
┬а document.getElementById('tableHeader').innerHTML="";
┬а barChart?.destroy(); donutChart?.destroy(); // рдЪрд╛рд░реНрдЯ рдирд╖реНрдЯ рдХрд░рд╛
}

// рд╕рд░реНрд╡ рдШрдЯрдХ рдЕрджреНрдпрддрдирд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function updateAll() {
┬а const data = compute(); // рдбреЗрдЯрд╛рдЪреА рдЧрдгрдирд╛ рдХрд░рд╛
┬а if(!data || data.blocksArr.length === 0) { // рдлрд┐рд▓реНрдЯрд░рд┐рдВрдЧрдирдВрддрд░ рдбреЗрдЯрд╛ рдирд╕рд▓реНрдпрд╛рд╕
┬а ┬а clearDashboard();
┬а ┬а alert("рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдирд┐рдХрд╖рд╛рдВрдиреБрд╕рд╛рд░ рдХреЛрдгрддрд╛рд╣реА рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реА.");
┬а ┬а return;
┬а }
┬а renderKPI(data); // KPI рд░реЗрдВрдбрд░ рдХрд░рд╛
┬а renderBar(data); // рдмрд╛рд░ рдЪрд╛рд░реНрдЯ рд░реЗрдВрдбрд░ рдХрд░рд╛
┬а renderDonut(data); // рдбреЛрдирдЯ рдЪрд╛рд░реНрдЯ рд░реЗрдВрдбрд░ рдХрд░рд╛
┬а renderTable(data); // рдЯреЗрдмрд▓ рд░реЗрдВрдбрд░ рдХрд░рд╛
}

// рдбреЗрдЯрд╛ CSV рдореНрд╣рдгреВрди рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function downloadCSV() {
┬а const data = compute(); // рдбреЗрдЯрд╛рдЪреА рдЧрдгрдирд╛ рдХрд░рд╛
┬а if(!data || data.blocksArr.length === 0) {
┬а ┬а alert("CSV рдирд┐рд░реНрдпрд╛рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЛрдгрддрд╛рд╣реА рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реА.");
┬а ┬а return;
┬а }
┬а let csv = 'рд░рдБрдХ,' + headers.join(',') + '\n' + data.kpiData.map(r => {
┬а ┬а const originalDataRow = rawData.find(x => x._block === r._block);
┬а ┬а return `${r.rank},` + headers.map(h => `"${originalDataRow[h] || ''}"`).join(',');
┬а }).join('\n');
┬а const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); // рдорд░рд╛рдареА рд╡рд░реНрдгрдирд╛рдВрд╕рд╛рдареА utf-8 рдПрдиреНрдХреЛрдбрд┐рдВрдЧ
┬а const url = URL.createObjectURL(blob);
┬а const a = document.createElement('a');
┬а a.href = url; a.download = 'taluka-data.csv'; a.click();
┬а URL.revokeObjectURL(url);
}

// рд╕реБрд░реБрд╡рд╛рддреАрд▓рд╛ ре▓рдк рд▓реЛрдб рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рдЪрд╛рд▓рдгрд╛рд░реЗ рдлрдВрдХреНрд╢рди
(async () => {
┬а try {
┬а ┬а const vals = await fetchSheet(); // рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рдбреЗрдЯрд╛ рдЖрдгрд╛
┬а ┬а parse(vals); // рдбреЗрдЯрд╛ рдкрд╛рд░реНрд╕ рдХрд░рд╛
┬а ┬а renderControls(); // рдирд┐рдпрдВрддреНрд░рдг рдШрдЯрдХ рд░реЗрдВрдбрд░ рдХрд░рд╛
┬а ┬а showAllDefault(); // рдбреАрдлреЙрд▓реНрдЯрдиреБрд╕рд╛рд░ рд╕рд░реНрд╡ рдбреЗрдЯрд╛ рджрд╛рдЦрд╡рд╛
┬а } catch (e) {
┬а ┬а alert("рдбреЗрдЯрд╛ рд▓реЛрдбрдордзреНрдпреЗ рдЕрдбрдЪрдг: " + e.message + "\nрдХреГрдкрдпрд╛ рддреБрдордЪреНрдпрд╛ API рдХреА рдЖрдгрд┐ рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рд░реЗрдВрдЬрдЪреА рдЦрд╛рддреНрд░реА рдХрд░рд╛.");
┬а }
})();
</script>
</body>
</html>
