<!DOCTYPE html>
<html lang="mr">
<head>
┬а <meta charset="UTF-8">
┬а <title>рддрд╛рд▓реБрдХрд╛ рдпреЛрдЬрдирд╛ рддреБрд▓рдирд╛рддреНрдордХ рдбреЕрд╢рдмреЛрд░реНрдб тАУ рдЬрд│рдЧрд╛рд╡ рдЬрд┐рд▓реНрд╣рд╛</title>
┬а <meta name="viewport" content="width=device-width, initial-scale=1" />
┬а ┬а <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@500;700&display=swap" rel="stylesheet"/>
┬а <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
┬а <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
┬а <style>
┬а ┬а body { font-family: 'Noto Sans Devanagari', sans-serif; background: #f7fafc; color: #23263a; }
┬а ┬а .glass { background: #fff; border-radius: 14px; box-shadow: 0 2px 10px #bac2f2bb; margin-bottom: 1.2rem; padding:1.1rem; }
┬а ┬а .dashboard-3col { display: flex; flex-wrap: wrap; gap: 1.1rem; }
┬а ┬а .dashboard-3col > div { background: #f4f6fa; border-radius: 10px; padding: 0.7rem; flex: 1 1 30%; }
┬а ┬а .kpi-card { border-radius: 10px; text-align: center; padding: .55em .6em .4em .6em; font-size:0.99em; font-weight: 700; margin:.15em 0; box-shadow:0 2px 6px #dbeafe20;}
┬а ┬а .kpi-card span.chip { font-size:1em; display:block; font-weight:600;}
┬а ┬а .kpi-card.top┬а { background:linear-gradient(90deg,#bbf7d0 70%,#6ee7b7);}
┬а ┬а .kpi-card.mid┬а { background:linear-gradient(90deg,#fde68a,#fef9c3);}
┬а ┬а .kpi-card.bot┬а { background:linear-gradient(90deg,#fecaca,#f87171);}
┬а ┬а .kpi-card.selected { border: 2px solid #6366f1; box-shadow:0 3px 20px #a5b4fc33;}
┬а ┬а .dept-chip {
┬а ┬а ┬а display:inline-block; padding:7px 14px; border-radius:25px; font-size:.99em; background:#e0e7ff; margin:2px 6px 4px 0; color:#2d3d80;
┬а ┬а ┬а font-weight:600; box-shadow:0 2px 8px #5661b422;transition:transform .18s,background .15s;
┬а ┬а ┬а cursor:pointer; border:2.2px solid transparent;
┬а ┬а }
┬а ┬а .dept-chip:hover, .dept-chip.selected {
┬а ┬а ┬а background:linear-gradient(91deg,#facc15 25%,#fbbf24 100%);
┬а ┬а ┬а color:#262626; border-color:#f59e0b; transform:scale(1.08); z-index:2;
┬а ┬а }
┬а ┬а /* Chart specific adjustments */
┬а ┬а .chart-container { height: 250px; /* Increased height for better visibility */ min-height: 150px; }
┬а ┬а .dashboard-3col .chart-container { background:#fff; border-radius:10px; padding:.25rem; /* Reduced padding */ }
┬а ┬а .form-label { font-weight: 600;}
┬а ┬а .btn-export { margin-left:0.5rem;}
┬а ┬а .table thead th {
┬а ┬а ┬а background: #6366f1; color: #fff; border: 1px solid #6366f1; text-align: center;vertical-align: middle; font-size:1.01em;padding:.48em;}
┬а ┬а .table tbody td { border: 1px solid #e6e6ed; vertical-align: middle; padding: .37rem .2rem; text-align:center; font-size:.95em;}
┬а ┬а .table tbody tr.selected-block td { background: #c7d2fe!important; font-weight:700; color:#1816a0;}
┬а ┬а .table tbody tr.top5┬а td { background: #bbf7d0 !important;}
┬а ┬а .table tbody tr.mid5┬а td { background: #feeaa4 !important;}
┬а ┬а .table tbody tr.bot5┬а td { background: #ffdada !important;}
┬а ┬а @media (max-width: 950px) {.dashboard-3col{flex-direction:column;gap:.8rem;}
┬а ┬а ┬а .dashboard-3col>div{min-width:0;}
┬а ┬а }
┬а ┬а .info-badge {background: #f1f5fa;color: #344e74;font-size:.97em; padding:7px 12px; border-radius:8px;margin-bottom:1rem; border-left:4px solid #6366f1;}
┬а ┬а .nav-pills .nav-link { font-weight:600; }
┬а ┬а .nav-pills .nav-link.active { background: #6366f1; }
┬а </style>
</head>
<body>
<div class="container-fluid pb-3">
┬а <h2 class="text-center mb-2">ЁЯУК рддрд╛рд▓реБрдХрд╛ рдпреЛрдЬрдирд╛ рддреБрд▓рдирд╛рддреНрдордХ рдбреЕрд╢рдмреЛрд░реНрдб<br>
┬а ┬а <small class="text-muted" style="font-size:1em;">(рдЬрд│рдЧрд╛рд╡ рдЬрд┐рд▓реНрд╣рд╛)</small>
┬а </h2>
┬а <div class="glass mb-3">
┬а ┬а <div class="row g-2 align-items-center">
┬а ┬а ┬а <div class="col-md-6 col-lg-5">
┬а ┬а ┬а ┬а <label class="form-label">рдпреЛрдЬрдирд╛ рдирд┐рд╡рдбрд╛ (Multiple):</label>
┬а ┬а ┬а ┬а <select id="schemeSelect" multiple class="form-select form-select-sm" size="7"></select>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div class="col-md-6 col-lg-5">
┬а ┬а ┬а ┬а <label class="form-label">рддрд╛рд▓реБрдХрд╛ рдирд┐рд╡рдбрд╛:</label>
┬а ┬а ┬а ┬а <div id="talukaChips" class="mb-2"></div>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div class="col-md-12 col-lg-2 text-end mt-2 mt-lg-0">
┬а ┬а ┬а ┬а <button id="resetBtn" class="btn btn-outline-danger btn-sm">Reset</button>
┬а ┬а ┬а ┬а <button id="submitBtn" class="btn btn-primary btn-sm ms-2">Submit</button>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а ┬а <div class="row mt-1">
┬а ┬а ┬а <div class="col-12">
┬а ┬а ┬а ┬а <div class="info-badge">
┬а ┬а ┬а ┬а ┬а <i class="fa fa-info-circle me-1"></i>┬а
┬а ┬а ┬а ┬а ┬а <b>рд╕реВрдЪрдирд╛:</b> "рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛" рдирд┐рд╡рдбрдгреНрдпрд╛рд╕рд╛рдареА рдкрд╣рд┐рд▓рд╛ рдкрд░реНрдпрд╛рдп рдирд┐рд╡рдбрд╛. рддрд╛рд▓реБрдХрд╛ рдирд┐рд╡рдбрд╛, <b>Submit</b> рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рд╛. рдкреНрд░рддреНрдпреЗрдХ рддрд╛рд▓реБрдХреНрдпрд╛рд╕рд╛рдареА KPI рд╡рд░ рдХреНрд▓рд┐рдХ рдХреЗрд▓реНрдпрд╛рд╕ рддреНрдпрд╛ рддрд╛рд▓реБрдХреНрдпрд╛рдЪрд╛ scheme-wise self-assessment рд░рд┐рдкреЛрд░реНрдЯ рджрд┐рд╕реЗрд▓.
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а </div>
┬а┬а
┬а <div class="glass">
┬а ┬а <div class="dashboard-3col">
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div id="kpiCol"></div>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div class="text-primary mb-2" style="font-weight:700;font-size:.98em;">Bar Chart</div>
┬а ┬а ┬а ┬а <div id="barArea" class="chart-container"><canvas id="barChart"></canvas></div>
┬а ┬а ┬а ┬а <button id="downloadBarBtn" class="btn btn-success btn-sm btn-export mt-1">тмЗя╕П Bar Chart</button>
┬а ┬а ┬а </div>
┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а <div class="text-primary mb-2" style="font-weight:700;font-size:.98em;">Donut Chart</div>
┬а ┬а ┬а ┬а <div id="donutArea" class="chart-container"><canvas id="donutChart"></canvas></div>
┬а ┬а ┬а ┬а <button id="downloadDonutBtn" class="btn btn-warning btn-sm btn-export mt-1">тмЗя╕П Donut Chart</button>
┬а ┬а ┬а </div>
┬а ┬а </div>
┬а </div>
┬а <div class="glass mb-3">
┬а ┬а <h5 class="mb-2 text-primary" style="font-size:1.08em;">
┬а ┬а ┬а <i class="fa fa-table me-2"></i>рддрд╛рд▓реБрдХреНрдпрд╛рдВрдЪреА рдкреВрд░реНрдг рдорд╛рд╣рд┐рддреА рд╡ рд░рдБрдХрд┐рдВрдЧ
┬а ┬а ┬а <button id="downloadCsvBtn" class="btn btn-secondary btn-xs btn-export float-end">ЁЯУК CSV</button>
┬а ┬а </h5>
┬а ┬а <div class="table-responsive">
┬а ┬а ┬а <table class="table table-bordered mb-0" id="dataTable">
┬а ┬а ┬а ┬а <thead><tr id="tableHeader"></tr></thead>
┬а ┬а ┬а ┬а <tbody id="tableBody"></tbody>
┬а ┬а ┬а </table>
┬а ┬а </div>
┬а </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
const CONFIG = {
┬а apiKey: "AIzaSyDhCjnUv7x5yj9cXKV52Qv8CrYwUhBIWuU",
┬а spreadsheetId: "1y_EVqNg-reS3xV-Kn6cmTou7u_6kuyqykNdgdzXEMkE",
┬а range: "Rank!B5:AJ20"
};
let rawData=[], headers=[], blocks=[], schemes=[];
let barChart, donutChart;
const selectedBlocks = new Set(), selectedSchemes = new Set();

// Data fetch and initialization
async function fetchSheet() {
┬а const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.spreadsheetId}/values/${encodeURIComponent(CONFIG.range)}?majorDimension=ROWS&valueRenderOption=UNFORMATTED_VALUE&key=${CONFIG.apiKey}`;
┬а const res = await fetch(url);
┬а if (!res.ok) throw Error(res.statusText);
┬а return (await res.json()).values;
}
function parse(values) {
┬а headers = values[0];
┬а const idxBlock=headers.findIndex(h=>/рддрд╛рд▓реБрдХрд╛/i.test(h));
┬а blocks = values.slice(1).map(r => {const obj={}; headers.forEach((h,i)=>obj[h]=r[i]); obj._block=r[idxBlock]; return obj;});
┬а schemes = headers.filter((_,i) => i!==idxBlock); // All columns except the 'Taluka' one are schemes
┬а rawData = blocks;
}
function renderControls() {
┬а const schemeSel=document.getElementById('schemeSelect');
┬а schemeSel.innerHTML = `<option value="__all__" style="font-weight:bold;">рд╕рд░реНрд╡ рдпреЛрдЬрдирд╛</option>`┬а
┬а ┬а ┬а ┬а + schemes.map(s=>`<option value="${s}">${s}</option>`).join('');
┬а schemeSel.addEventListener('change',()=>{
┬а ┬а const val = Array.from(schemeSel.selectedOptions).map(o=>o.value);
┬а ┬а const allSelected = val.includes('__all__');
┬а ┬а if(allSelected) {
┬а ┬а ┬а for (let option of schemeSel.options) if (option.value !== '__all__') option.selected=true;
┬а ┬а }
┬а ┬а // Uncheck __all__ if not all schemes is selected
┬а ┬а const allActual = Array.from(schemeSel.options).filter(o=>o.value!=="__all__" && o.selected);
┬а ┬а if(allActual.length===schemes.length)
┬а ┬а ┬а schemeSel.querySelector('option[value="__all__"]').selected=true;
┬а ┬а else
┬а ┬а ┬а schemeSel.querySelector('option[value="__all__"]').selected=false;
┬а });
┬а // Department/Taluka chips (not selected by default)
┬а const talukaDiv=document.getElementById('talukaChips');
┬а talukaDiv.innerHTML=blocks.map(b=>`
┬а ┬а <span class="dept-chip" tabindex="0" data-block="${b._block}">${b._block}</span>
┬а `).join('');
┬а talukaDiv.querySelectorAll('.dept-chip').forEach(span=>{
┬а ┬а span.onclick=()=>{
┬а ┬а ┬а const name=span.getAttribute('data-block');
┬а ┬а ┬а if(selectedBlocks.has(name)) { selectedBlocks.delete(name); span.classList.remove('selected');}
┬а ┬а ┬а else {selectedBlocks.add(name); span.classList.add('selected');}
┬а ┬а };
┬а });
┬а document.getElementById('resetBtn').onclick = () => {
┬а ┬а selectedBlocks.clear(); selectedSchemes.clear();
┬а ┬а talukaDiv.querySelectorAll('.dept-chip').forEach(span=>span.classList.remove('selected'));
┬а ┬а schemeSel.selectedIndex=-1;
┬а ┬а clearDashboard();
┬а ┬а showAllDefault();
┬а };
┬а document.getElementById('submitBtn').onclick = updateAll;
┬а document.getElementById('downloadBarBtn').onclick=()=>barChart && downloadChart(barChart,"bar-chart.png");
┬а document.getElementById('downloadDonutBtn').onclick=()=>donutChart && downloadChart(donutChart,"donut-chart.png");
┬а document.getElementById('downloadCsvBtn').onclick = downloadCSV;
}
// Chart/Export helpers
function downloadChart(chart,filename){
┬а const a=document.createElement('a');
┬а a.href=chart.toBase64Image(); a.download=filename; a.click();
}
function collectSelections() {
┬а // block chips
┬а selectedBlocks.clear();
┬а document.querySelectorAll('#talukaChips .dept-chip.selected').forEach(el=>selectedBlocks.add(el.getAttribute('data-block')));
┬а // multi select schemes
┬а selectedSchemes.clear();
┬а Array.from(document.getElementById('schemeSelect').selectedOptions).forEach(opt => {
┬а ┬а if(opt.value === "__all__") {
┬а ┬а ┬а schemes.forEach(s=>selectedSchemes.add(s));
┬а ┬а } else {
┬а ┬а ┬а selectedSchemes.add(opt.value);
┬а ┬а }
┬а });
}
// Main compute: treat empty as all
function compute() {
┬а collectSelections();
┬а const schemesArr = selectedSchemes.size ? Array.from(selectedSchemes) : schemes.slice();
┬а const blocksArr = selectedBlocks.size ? Array.from(selectedBlocks).map(b=>rawData.find(r=>r._block===b)).filter(Boolean) : rawData.slice();

┬а // Calculate '1' count for each block and prepare data for ranking
┬а const kpiData = blocksArr.map(block => {
┬а ┬а let oneCount = 0;
┬а ┬а schemes.forEach(scheme => { // Iterate over all schemes (columns)
┬а ┬а ┬а if (parseFloat(block[scheme]) === 1) { // Check if the value is numerically 1
┬а ┬а ┬а ┬а oneCount++;
┬а ┬а ┬а }
┬а ┬а });
┬а ┬а return { _block: block._block, val: oneCount }; // 'val' now represents the count of '1's
┬а });
┬а kpiData.sort((a,b)=>b.val-a.val); // Sort by count of '1's descending
┬а kpiData.forEach((d,i)=>d.rank=i+1); // Assign ranks

┬а // For KPI display, we'll still use the scheme that might be implicitly selected or the first one.
┬а // However, the primary ranking logic now depends on '1' counts.
┬а const kpiScheme = schemesArr.length ? schemesArr[0] : (schemes[0]||"");

┬а return { blocksArr, kpiData, schemesArr, kpiScheme };
}
// KPI rendering
function renderKPI(data) {
┬а if(!data || data.kpiData.length === 0) { document.getElementById('kpiCol').innerHTML = ""; return; }
┬а let out = "";
┬а if(data.kpiData[0]) out += `
┬а ┬а <div class="kpi-card top selected" onclick="selfAssessment('${data.kpiData[0]._block}')">
┬а ┬а ┬а <span class="chip">ЁЯПЖ Top</span>${data.kpiData[0]._block}<div>${data.kpiData[0].val}</div>
┬а ┬а </div>`;
┬а if(data.kpiData.length>2){
┬а ┬а const midIndex = Math.floor(data.kpiData.length/2);
┬а ┬а const mid = data.kpiData[midIndex];
┬а ┬а out += `<div class="kpi-card mid selected" onclick="selfAssessment('${mid._block}')">
┬а ┬а ┬а <span class="chip">тЪЦя╕П рдордзреНрдпрдо</span>${mid._block}<div>${mid.val}</div></div>`;
┬а }
┬а if(data.kpiData.at(-1)){
┬а ┬а out += `<div class="kpi-card bot selected" onclick="selfAssessment('${data.kpiData.at(-1)._block}')">
┬а ┬а ┬а <span class="chip">ЁЯЪи рддрд│</span>${data.kpiData.at(-1)._block}<div>${data.kpiData.at(-1).val}</div></div>`;
┬а }
┬а document.getElementById('kpiCol').innerHTML = out;
}
// Self-assessment popup for a taluka
window.selfAssessment = function(talukaName) {
┬а if(!talukaName) return;
┬а const assessments = schemes.map(scheme => {
┬а ┬а const ranks = rawData.map(r => ({
┬а ┬а ┬а taluka: r._block, val: parseFloat(r[scheme]) || 0
┬а ┬а })).sort((a,b) => b.val - a.val);
┬а ┬а const rankObj = ranks.find(x => x.taluka === talukaName);
┬а ┬а return { scheme, rank: rankObj ? ranks.indexOf(rankObj) + 1 : null, score: rankObj ? rankObj.val : 0 };
┬а });
┬а assessments.sort((a,b) => a.rank-b.rank);
┬а const n = rawData.length;
┬а const top5 = assessments.filter(a=>a.rank && a.rank<=5);
┬а const bottom5 = assessments.filter(a=>a.rank && a.rank>=(n-4));
┬а alert("рддрд╛рд▓реБрдХрд╛: "+talukaName+
┬а ┬а "\n\nЁЯПЖ рдЙрддреНрддрдо рдпреЛрдЬрдирд╛ (Top 5):\n"+top5.map(a=>`${a.scheme}: ${a.rank} (${a.score})`).join('\n')+
┬а ┬а "\n\nЁЯЪи рд▓рдХреНрд╖ рджреНрдпрд╛рд╡реНрдпрд╛рдд рдЕрд╢рд╛ (Bottom 5):\n"+bottom5.map(a=>`${a.scheme}: ${a.rank} (${a.score})`).join('\n')
┬а );
};
// Charts
function renderBar(data) {
┬а const ctx=document.getElementById('barChart').getContext('2d');
┬а barChart?.destroy();
┬а barChart=new Chart(ctx, {
┬а ┬а type:'bar',
┬а ┬а data: {
┬а ┬а ┬а labels: data.kpiData.map(d=>d._block),
┬а ┬а ┬а datasets: [{
┬а ┬а ┬а ┬а label: 'Count of "1"s', // Updated label to reflect the new metric
┬а ┬а ┬а ┬а data: data.kpiData.map(d=>d.val),
┬а ┬а ┬а ┬а backgroundColor:'#6366f1', borderRadius:4
┬а ┬а ┬а }]
┬а ┬а },
┬а ┬а options:{
┬а ┬а ┬а indexAxis:'y',
┬а ┬а ┬а plugins:{
┬а ┬а ┬а ┬а legend:{display:false},
┬а ┬а ┬а ┬а datalabels:{
┬а ┬а ┬а ┬а ┬а anchor:'end',
┬а ┬а ┬а ┬а ┬а align:'right',
┬а ┬а ┬а ┬а ┬а formatter:v=>v,
┬а ┬а ┬а ┬а ┬а color: '#333' // Added color for datalabels
┬а ┬а ┬а ┬а }
┬а ┬а ┬а },
┬а ┬а ┬а responsive:true,
┬а ┬а ┬а maintainAspectRatio: false, // Allows chart to take up full container
┬а ┬а ┬а scales: {
┬а ┬а ┬а ┬а x: {
┬а ┬а ┬а ┬а ┬а beginAtZero: true,
┬а ┬а ┬а ┬а ┬а ticks: {
┬а ┬а ┬а ┬а ┬а ┬а precision: 0 // Ensure whole numbers for counts
┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а }
┬а ┬а },
┬а ┬а plugins:[ChartDataLabels]
┬а });
}
function renderDonut(data) {
┬а const ctx=document.getElementById('donutChart').getContext('2d');
┬а donutChart?.destroy();
┬а donutChart=new Chart(ctx, {
┬а ┬а type:'doughnut',
┬а ┬а data:{
┬а ┬а ┬а labels: data.kpiData.map(d=>d._block),
┬а ┬а ┬а datasets:[{
┬а ┬а ┬а ┬а data: data.kpiData.map(d=>d.val),
┬а ┬а ┬а ┬а backgroundColor:['#4f46e5','#10b981','#f59e0b','#ef4444','#3b82f6','#818cf8','#f472b6','#2dd4bf','#facc15','#eab308','#c026d3']
┬а ┬а ┬а }]
┬а ┬а },
┬а ┬а options:{
┬а ┬а ┬а plugins:{
┬а ┬а ┬а ┬а legend:{position:'bottom'},
┬а ┬а ┬а ┬а datalabels:{
┬а ┬а ┬а ┬а ┬а anchor:'end',
┬а ┬а ┬а ┬а ┬а align:'end',
┬а ┬а ┬а ┬а ┬а formatter:v=>v,
┬а ┬а ┬а ┬а ┬а color: '#333' // Added color for datalabels
┬а ┬а ┬а ┬а }
┬а ┬а ┬а },
┬а ┬а ┬а responsive:true,
┬а ┬а ┬а maintainAspectRatio: false // Allows chart to take up full container
┬а ┬а },
┬а ┬а plugins:[ChartDataLabels]
┬а });
}
function renderTable(data) {
┬а const th = `<th>рд░рдБрдХ</th>` + headers.map(h => `<th>${h}</th>`).join('');
┬а document.getElementById('tableHeader').innerHTML = th;
┬а const n = data.kpiData.length;
┬а 
┬а // Find the middle 5 based on the sorted kpiData for visual grouping.
┬а // This logic might need refinement if 'middle' has a specific definition.
┬а // For now, it will be the 5 rows around the mathematical middle index.
┬а const middleStartIndex = Math.max(0, Math.floor(n / 2) - 2); // Start 2 before middle
┬а const middleEndIndex = Math.min(n - 1, middleStartIndex + 4); // End 2 after middle

┬а const rows = data.kpiData.map((r,i) => {
┬а ┬а const classes = [
┬а ┬а ┬а i < 5 ? 'top5' : '', // Top 5
┬а ┬а ┬а i >= n - 5 ? 'bot5' : '', // Bottom 5
┬а ┬а ┬а // Check if the current index is within the calculated middle range (and not already in top/bottom 5)
┬а ┬а ┬а (i >= middleStartIndex && i <= middleEndIndex && i >= 5 && i < n - 5) ? 'mid5' : '', 
┬а ┬а ┬а selectedBlocks.has(r._block) ? 'selected-block' : ''
┬а ┬а ].filter(Boolean).join(' ');
┬а ┬а 
┬а ┬а // Find the original rawData entry to display all columns
┬а ┬а const originalDataRow = rawData.find(x => x._block === r._block);
┬а ┬а return `
┬а ┬а ┬а <tr class="${classes}">
┬а ┬а ┬а ┬а <td>${r.rank}</td>${headers.map(h => `<td>${originalDataRow[h] || ''}</td>`).join('')}
┬а ┬а ┬а </tr>`;
┬а }).join('');
┬а document.getElementById('tableBody').innerHTML = rows;
}
// Landing: Show all data as default if no selection
function showAllDefault() {
┬а selectedSchemes.clear(); schemes.forEach(s=>selectedSchemes.add(s));
┬а selectedBlocks.clear(); blocks.forEach(b=>selectedBlocks.add(b._block));
┬а // Manually select the "All Schemes" option if it exists
┬а const allSchemesOption = document.querySelector('#schemeSelect option[value="__all__"]');
┬а if (allSchemesOption) {
┬а ┬а allSchemesOption.selected = true;
┬а ┬а // Also select all other options to reflect "All Schemes" visually
┬а ┬а Array.from(document.getElementById('schemeSelect').options).forEach(opt => {
┬а ┬а ┬а if (opt.value !== '__all__') opt.selected = true;
┬а ┬а });
┬а }
┬а document.querySelectorAll('#talukaChips .dept-chip').forEach(span=>span.classList.remove('selected')); // Deselect all chips initially
┬а updateAll();
}
function clearDashboard() {
┬а document.getElementById('kpiCol').innerHTML="";
┬а document.getElementById('tableBody').innerHTML="";
┬а document.getElementById('tableHeader').innerHTML="";
┬а barChart?.destroy(); donutChart?.destroy();
}
function updateAll() {
┬а const data = compute();
┬а if(!data || data.blocksArr.length === 0) { // Check if there's any data after filtering
┬а ┬а clearDashboard();
┬а ┬а alert("рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ рдирд┐рдХрд╖рд╛рдВрдиреБрд╕рд╛рд░ рдХреЛрдгрддрд╛рд╣реА рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реА.");
┬а ┬а return;
┬а }
┬а renderKPI(data);
┬а renderBar(data);
┬а renderDonut(data);
┬а renderTable(data);
}
function downloadCSV() {
┬а const data = compute();
┬а if(!data || data.blocksArr.length === 0) {
┬а ┬а alert("CSV рдирд┐рд░реНрдпрд╛рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЛрдгрддрд╛рд╣реА рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реА.");
┬а ┬а return;
┬а }
┬а let csv = 'рд░рдБрдХ,' + headers.join(',') + '\n' + data.kpiData.map(r => {
┬а ┬а const originalDataRow = rawData.find(x => x._block === r._block);
┬а ┬а return `${r.rank},` + headers.map(h => `"${originalDataRow[h] || ''}"`).join(',');
┬а }).join('\n');
┬а const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); // Added charset for proper Marathi display
┬а const url = URL.createObjectURL(blob);
┬а const a = document.createElement('a');
┬а a.href = url; a.download = 'taluka-data.csv'; a.click();
┬а URL.revokeObjectURL(url);
}
(async () => {
┬а try {
┬а ┬а const vals = await fetchSheet();
┬а ┬а parse(vals);
┬а ┬а renderControls();
┬а ┬а showAllDefault();
┬а } catch (e) {
┬а ┬а alert("рдбреЗрдЯрд╛ рд▓реЛрдбрдордзреНрдпреЗ рдЕрдбрдЪрдг: " + e.message + "\nрдХреГрдкрдпрд╛ рддреБрдордЪреНрдпрд╛ API рдХреА рдЖрдгрд┐ рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рд░реЗрдВрдЬрдЪреА рдЦрд╛рддреНрд░реА рдХрд░рд╛.");
┬а }
})();
</script>
</body>
</html>
